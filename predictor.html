<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIMED Predictor</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="icon" type="image/png" sizes="32x32" href=".\src\img\aimed-icon.png" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./dist/assets/css/style.css" />
</head>
 
<body class="bg-gray-100">
  <!--Header-->
  <header class="fixed w-full lg:px-[5em] z-50 bg-white overflow-x-hidden">
    <div class="container max-w-screen-xl mx-auto flex justify-between items-center p-5 lg:py-0">
      <a href="./"><img src="./src/img/aimed-removed.png" alt="brand logo"
          style="max-width: 160px; height: auto" /></a>
      <nav class="hidden lg:block" aria-labelledby="header-nav-desktop">
        <ul class="flex gap-3">
          <li>
            <a class="block px-3 py-5 relative after:content[''] after:absolute after:block after:bottom-0 after:left-0 after:h-1 after:w-0 after:bg-primary-gradient after:transition-all after:duration-150 after: hover:text-primary hover:after:w-full"
              href="./">Home</a>
          </li>
          <li>
            <a class="block px-3 py-5 relative after:content[''] after:absolute after:block after:bottom-0 after:left-0 after:h-1 after:w-0 after:bg-primary-gradient after:transition-all after:duration-150 after: hover:text-primary hover:after:w-full"
              href="./extract-text">Scan</a>
          </li>
          <li>
            <a class="block px-3 py-5 relative after:content[''] after:absolute after:block after:bottom-0 after:left-0 after:h-1 after:w-0 after:bg-primary-gradient after:transition-all after:duration-150 after: hover:text-primary hover:after:w-full"
              href="./predictor">Prediction</a>
          </li>
          <li>
            <a class="block px-3 py-5 relative font-primary text-primary after:content[''] after:absolute after:block after:bottom-0 after:left-0 after:h-1 after:w-0 after:bg-primary-gradient after:transition-all after:duration-150 after: hover:text-primary hover:after:w-full"
              href="./blogs">Blog</a>
          </li>

        </ul>
      </nav>
      <div class="hidden lg:block">
        <a class="ds-btn ds-btn-primary ds-btn-wide" href="./LoginSignup">Login | Signup</a>
      </div>

      <!-- burger icon on mobile -->
      <nav class="nav__icon lg:hidden" aria-labelledby="header-nav-mobile">
        <span></span>
        <span></span>
        <span></span>
      </nav>
    </div>
  </header>

  <div class="w-full m-0 p-0 bg-cover bg-bottom"
    style="background-image: url('./src/img/cover.jpg'); max-height: 2100px">
    <div class="font-extrabold container max-w-4xl mx-auto pt-28 pb-6 md:pb-10 text-center">
      <div class="text-white text-2xl md:text-5xl sm:text-4xl">
        Disease Predictor
      </div>
      <p class="text-xl md:text-2xl text-gray-300">
        Get probable diseases & treatment
      </p>
    </div>
  </div>

  <main class="container px-4 py-8">
    <div class="grid grid-cols-1 gap-4">
      <div class="bg-white rounded-lg p-8 whitespace-normal">
        <p class="pl-1 pb-2 text-sm">Write the symptoms you are experiencing</p>
        <input title="text-input" type="text" id="text-input"
          class="w-full px-4 py-2 border border-green-300 rounded-md shadow-sm focus:outline-none"
          value="fever from past 3 days, shivering, throat pain, cold">
      </div>

      <div id="display-text" class="bg-white rounded-lg p-4 whitespace-normal flex flex-col items-center">
        <button id="analyze-btn" class="ds-btn ds-btn-primary ds-btn-wide mt-4">Analyze</button>
        <div id="analysis-result" class="p-2">

        </div>
        <!-- Loading animation -->
        <div id="loading-animation" class="hidden w-full flex justify-center items-center p-2">
          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gray-900"></div>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-primary p-10 md:p-[3em]" id="footerid">
    <div class="max-w-screen-xl mx-auto flex flex-wrap justify-between gap-3 lg:items-stretch lg:gap-0">
      <!-- col 1 -->
      <div class="w-full flex flex-col justify-between items-center gap-5 lg:w-1/5 lg:pr-5">
        <!-- <img src="./src/img/aimed-icon.png" alt="brand logo" style="max-width: 60px; height: auto;"/> -->
        <nav aria-labelledby="social-media-links">
          <ul class="flex gap-5 my-2 lg:my-auto">
            <li>
              <a class="text-white hover:text-secondary text-xl lg:text-lg"
                href="https://www.hackerrank.com/profile/prashantzz" aria-label="Facebook profile of <b>AI</b>MED">
                <i class="fa-brands fa-hackerrank"></i>
              </a>
            </li>
            <li>
              <a class="text-white hover:text-secondary text-xl lg:text-lg" href="https://www.github.com/prashantzzz"
                aria-label="Youtube account of <b>AI</b>MED">
                <i class="fa-brands fa-github"></i>
              </a>
            </li>
            <li>
              <a class="text-white hover:text-secondary text-xl lg:text-lg"
                href="https://www.linkedin.com/in/prashantzz/" aria-label="Twitter profile of <b>AI</b>MED">
                <i class="fa-brands fa-linkedin"></i>
              </a>
            </li>
            <li>
              <a class="text-white hover:text-secondary text-xl lg:text-lg"
                href="https://www.instagram.com/prashant.zz/" aria-label="Instagram profile of <b>AI</b>MED">
                <i class="fa-brands fa-instagram"></i>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <!-- col 2 -->
      <div class="w-full flex flex-col gap-16 lg:w-1/5 lg:pr-5">
        <nav aria-labelledby="footer-nav-1">
          <ul class="flex flex-col items-center gap-3 lg:items-start lg:gap-4">
            <li>
              <a class="text-white hover:text-secondary" href="./">Home</a>
            </li>
            <li>
              <a class="text-white hover:text-secondary" href="./blogs">Blog</a>
            </li>
            <li>
              <a class="text-white hover:text-secondary" href="./review">Review | Suggestion</a>
            </li>
          </ul>
        </nav>
      </div>
      <!-- col 3 -->
      <div class="w-full flex flex-col gap-16 lg:w-1/5 lg:pr-5">
        <nav aria-labelledby="footer-nav-2">
          <ul class="flex flex-col items-center gap-3 lg:items-start lg:gap-4">
            <li>
              <a class="text-white hover:text-secondary" href="https://www.linkedin.com/in/prashantzzz/">Contact
                Developer</a>
            </li>
            <li>
              <a class="text-white hover:text-secondary" href="https://g.co/kgs/p7xU2va">VIT Vellore,
                Tamil Nadu</a>
            </li>
          </ul>
        </nav>
      </div>
      <!-- col 4 -->
      <div class="w-full flex flex-col items-center lg:items-end lg:w-2/5">
        <!-- <a class="ds-btn ds-btn-primary ds-btn-wide my-3 lg:my-auto" href="#">Start Diagnosing</a> -->

        <span class="mt-4 mb-1 text-white">Â© <b>AI</b>MED. All Rights Reserved</span>
        <div class="text-xs lg:text-right text-white">
          Developed by
          <a class="text-secondary" target="_blank" href="https://www.linkedin.com/in/prashantzzz/">Prashant</a>
          <!-- <a class="text-secondary" target="_blank" href="https://www.linkedin.com/in/prashantzzz/">Chirag</a>
      <a class="text-secondary" target="_blank" href="https://www.linkedin.com/in/prashantzzz/">Anas</a> -->
        </div>
      </div>
    </div>
  </footer>

  <div class="nav__mobile-menu">
    <ul class="flex flex-col items-center gap-4">
      <li>
        <a href="./LoginSignup" class="ds-btn ds-btn-primary ds-btn-wide px-2 py-4">Login / Signup</a>
      </li>
      <li>
        <div class="dropdown bg-gray-100 border p-2 rounded-md" id="google_translate_element"></div>
      </li>
      <li>
        <a href="./" class="font-tertiary text-primary hover:text-secondary">Home</a>
      </li>
      <li>
        <a href="./blogs" class="font-tertiary text-secondary">Blog</a>
      </li>
    </ul>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js" defer></script>  

  <script src="dist/bundle.js"></script>
  <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
  </script>
  <script type="module"> 
    import { GoogleGenerativeAI } from "@google/generative-ai";
    const API_KEY = "AIzaSyDkOS4Xjuy3F3xYdV_nXnsEU_HEhxZPmgw";
    const genAI = new GoogleGenerativeAI(API_KEY);

    const inputElement = document.getElementById('text-input');
    // Add event listener for enter event
    inputElement.addEventListener('keypress', function(event) {
      if (event.key === "Enter") {
        analyzeText();
      }
    });

    function generateDiseaseCards(text) {
      // Parse JSON text to an array of objects
      const diseases = JSON.parse(text);
      
      // Get the element to append the cards
      const analysisResult = document.getElementById("analysis-result");


      // Iterate over each disease object
      diseases.forEach(disease => {
        // Create elements for disease card
        const cardDiv = document.createElement("div");
        cardDiv.className = "disease-card"; // Add a custom class for the container

        cardDiv.innerHTML = `
        <div x-data="{ openTab: 1 }" class="p-4">
          <div class="max-w-md mx-auto">
            <div class="mb-2 flex space-x-2 p-2 bg-white rounded-lg shadow-md">
                <button x-on:click="openTab = 1" :class="{ 'bg-green-500 text-white': openTab === 1 }" class="border flex-1 py-2 px-4 rounded-md focus:outline-none focus:shadow-outline-blue transition-all duration-300">Disease</button>
                <button x-on:click="openTab = 2" :class="{ 'bg-green-500 text-white': openTab === 2 }" class="border flex-1 py-2 px-4 rounded-md focus:outline-none focus:shadow-outline-blue transition-all duration-300">Symptom</button>
                <button x-on:click="openTab = 3" :class="{ 'bg-green-500 text-white': openTab === 3 }" class="border flex-1 py-2 px-4 rounded-md focus:outline-none focus:shadow-outline-blue transition-all duration-300">Treatment</button>
            </div>

            <div x-show="openTab === 1" class="transition-all duration-300 bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-500">
                <h2 class="text-2xl font-semibold mb-2 text-green-600">${disease.disease}</h2>
                <span class="bg-green-50 text-green-800 text-xs font-semibold px-2.5 py-1 my-2 rounded">Probability: ${disease.probability}</span>
                <p class="text-gray-700 mt-2">${disease.description}</p>
            </div>

            <div x-show="openTab === 2" class="transition-all duration-300 bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-500">
                <h2 class="text-2xl font-semibold mb-2 text-green-600">Realted Symptoms</h2>
                <p class="text-gray-700">${disease.symptoms}</p>
            </div>

            <div x-show="openTab === 3" class="transition-all duration-300 bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-500">
                <h2 class="text-2xl font-semibold mb-2 text-green-600">Suggested Treatments</h2>
                <p class="text-gray-700">${disease.treatment}</p>
            </div>
          </div>
        </div>
        `;

        // Append the card to the analysis result container
        // console.log(cardDiv.innerHTML);   //this code is running well when placed manually, but not when appended
        analysisResult.appendChild(cardDiv);
      });
    }

    async function analyzeText() {
      document.getElementById("analysis-result").textContent = '';
      const userInput = document.getElementById("text-input").value;
      const prompt = `I have the following symptoms: ${userInput}. Tell me which disease could I be suffering from and by what percentage? 
(don't include diseases having <10% probability. Respond strctly in following json format only:
[
  {
  "disease": "",
  "description": "",
  "probability": "",
  "symptoms": "",
  "treatment": ""
},
  {
  "disease": "",
  "description": "",
  "probability": "",
   "symptoms": "",
  "treatment": ""
},
  ...so on
]
`;
      // Show loading animation
      document.getElementById("loading-animation").classList.remove("hidden");

      try {
        const model = genAI.getGenerativeModel({ model: "gemini-pro" });
        const result = await model.generateContent(prompt);
        const response = await result.response;
        let text = await response.text().replace("json","");
        text = text.replaceAll("```","");
        text = text.replaceAll("*","");
        console.log(text);
 
        // Display the output in the 'analysis-result' div
        //document.getElementById("analysis-result").innerText= text;
        generateDiseaseCards(text);
      } catch (error) {
        // Display the error message
        document.getElementById("analysis-result").textContent = `Error: ${error.message.replace('[GoogleGenerativeAI Error]:', '')}`;
      } finally {
        // Hide loading animation
        document.getElementById("loading-animation").classList.add("hidden");
      }
    }

    document.getElementById("analyze-btn").addEventListener("click", analyzeText);
  </script>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js">
  </script>
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        ignoreWords: 'prescription,aimed,AI-MED,WHO',
        includedLanguages: 'en,hi,bn,te,mr,ta,ur,gu,kn,or,ml,pa,fra,zho' // Add the languages you want to include, separated by commas
      }, 'google_translate_element');
    };
  </script>

  <script type="text/javascript"
    src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <script src="./js/fontawesome-4414288e8e.js"></script>
</body>

</html>